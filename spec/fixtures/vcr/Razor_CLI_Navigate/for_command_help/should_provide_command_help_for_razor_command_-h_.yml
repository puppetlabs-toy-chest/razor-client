---
http_interactions:
- request:
    method: get
    uri: http://localhost:8150/api
    body:
      encoding: US-ASCII
      string: ''
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      User-Agent:
      - rest-client/2.0.2 (darwin x86_64) jruby/9.1.5.0 (2.3.1p0)
      Accept-Language:
      - en_US,en
      Host:
      - localhost:8150
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - Apache-Coyote/1.1
      X-Content-Type-Options:
      - nosniff
      Content-Type:
      - application/json
      Content-Length:
      - '7110'
      Date:
      - Mon, 23 Apr 2018 19:48:15 GMT
    body:
      encoding: UTF-8
      string: '{"commands":[{"name":"add-policy-tag","rel":"http://api.puppetlabs.com/razor/v1/commands/add-policy-tag","id":"http://localhost:8150/api/commands/add-policy-tag"},{"name":"create-broker","rel":"http://api.puppetlabs.com/razor/v1/commands/create-broker","id":"http://localhost:8150/api/commands/create-broker"},{"name":"create-hook","rel":"http://api.puppetlabs.com/razor/v1/commands/create-hook","id":"http://localhost:8150/api/commands/create-hook"},{"name":"create-policy","rel":"http://api.puppetlabs.com/razor/v1/commands/create-policy","id":"http://localhost:8150/api/commands/create-policy"},{"name":"create-repo","rel":"http://api.puppetlabs.com/razor/v1/commands/create-repo","id":"http://localhost:8150/api/commands/create-repo"},{"name":"create-tag","rel":"http://api.puppetlabs.com/razor/v1/commands/create-tag","id":"http://localhost:8150/api/commands/create-tag"},{"name":"create-task","rel":"http://api.puppetlabs.com/razor/v1/commands/create-task","id":"http://localhost:8150/api/commands/create-task"},{"name":"delete-broker","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-broker","id":"http://localhost:8150/api/commands/delete-broker"},{"name":"delete-hook","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-hook","id":"http://localhost:8150/api/commands/delete-hook"},{"name":"delete-node","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-node","id":"http://localhost:8150/api/commands/delete-node"},{"name":"delete-policy","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-policy","id":"http://localhost:8150/api/commands/delete-policy"},{"name":"delete-repo","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-repo","id":"http://localhost:8150/api/commands/delete-repo"},{"name":"delete-tag","rel":"http://api.puppetlabs.com/razor/v1/commands/delete-tag","id":"http://localhost:8150/api/commands/delete-tag"},{"name":"disable-policy","rel":"http://api.puppetlabs.com/razor/v1/commands/disable-policy","id":"http://localhost:8150/api/commands/disable-policy"},{"name":"enable-policy","rel":"http://api.puppetlabs.com/razor/v1/commands/enable-policy","id":"http://localhost:8150/api/commands/enable-policy"},{"name":"modify-node-metadata","rel":"http://api.puppetlabs.com/razor/v1/commands/modify-node-metadata","id":"http://localhost:8150/api/commands/modify-node-metadata"},{"name":"modify-policy-max-count","rel":"http://api.puppetlabs.com/razor/v1/commands/modify-policy-max-count","id":"http://localhost:8150/api/commands/modify-policy-max-count"},{"name":"move-policy","rel":"http://api.puppetlabs.com/razor/v1/commands/move-policy","id":"http://localhost:8150/api/commands/move-policy"},{"name":"reboot-node","rel":"http://api.puppetlabs.com/razor/v1/commands/reboot-node","id":"http://localhost:8150/api/commands/reboot-node"},{"name":"register-node","rel":"http://api.puppetlabs.com/razor/v1/commands/register-node","id":"http://localhost:8150/api/commands/register-node"},{"name":"reinstall-node","rel":"http://api.puppetlabs.com/razor/v1/commands/reinstall-node","id":"http://localhost:8150/api/commands/reinstall-node"},{"name":"remove-node-metadata","rel":"http://api.puppetlabs.com/razor/v1/commands/remove-node-metadata","id":"http://localhost:8150/api/commands/remove-node-metadata"},{"name":"remove-policy-tag","rel":"http://api.puppetlabs.com/razor/v1/commands/remove-policy-tag","id":"http://localhost:8150/api/commands/remove-policy-tag"},{"name":"run-hook","rel":"http://api.puppetlabs.com/razor/v1/commands/run-hook","id":"http://localhost:8150/api/commands/run-hook"},{"name":"set-node-desired-power-state","rel":"http://api.puppetlabs.com/razor/v1/commands/set-node-desired-power-state","id":"http://localhost:8150/api/commands/set-node-desired-power-state"},{"name":"set-node-hw-info","rel":"http://api.puppetlabs.com/razor/v1/commands/set-node-hw-info","id":"http://localhost:8150/api/commands/set-node-hw-info"},{"name":"set-node-ipmi-credentials","rel":"http://api.puppetlabs.com/razor/v1/commands/set-node-ipmi-credentials","id":"http://localhost:8150/api/commands/set-node-ipmi-credentials"},{"name":"update-broker-configuration","rel":"http://api.puppetlabs.com/razor/v1/commands/update-broker-configuration","id":"http://localhost:8150/api/commands/update-broker-configuration"},{"name":"update-hook-configuration","rel":"http://api.puppetlabs.com/razor/v1/commands/update-hook-configuration","id":"http://localhost:8150/api/commands/update-hook-configuration"},{"name":"update-node-metadata","rel":"http://api.puppetlabs.com/razor/v1/commands/update-node-metadata","id":"http://localhost:8150/api/commands/update-node-metadata"},{"name":"update-policy-broker","rel":"http://api.puppetlabs.com/razor/v1/commands/update-policy-broker","id":"http://localhost:8150/api/commands/update-policy-broker"},{"name":"update-policy-node-metadata","rel":"http://api.puppetlabs.com/razor/v1/commands/update-policy-node-metadata","id":"http://localhost:8150/api/commands/update-policy-node-metadata"},{"name":"update-policy-repo","rel":"http://api.puppetlabs.com/razor/v1/commands/update-policy-repo","id":"http://localhost:8150/api/commands/update-policy-repo"},{"name":"update-policy-task","rel":"http://api.puppetlabs.com/razor/v1/commands/update-policy-task","id":"http://localhost:8150/api/commands/update-policy-task"},{"name":"update-repo-task","rel":"http://api.puppetlabs.com/razor/v1/commands/update-repo-task","id":"http://localhost:8150/api/commands/update-repo-task"},{"name":"update-tag-rule","rel":"http://api.puppetlabs.com/razor/v1/commands/update-tag-rule","id":"http://localhost:8150/api/commands/update-tag-rule"}],"collections":[{"name":"brokers","rel":"http://api.puppetlabs.com/razor/v1/collections/brokers","id":"http://localhost:8150/api/collections/brokers"},{"name":"repos","rel":"http://api.puppetlabs.com/razor/v1/collections/repos","id":"http://localhost:8150/api/collections/repos"},{"name":"tags","rel":"http://api.puppetlabs.com/razor/v1/collections/tags","id":"http://localhost:8150/api/collections/tags"},{"name":"policies","rel":"http://api.puppetlabs.com/razor/v1/collections/policies","id":"http://localhost:8150/api/collections/policies"},{"name":"nodes","rel":"http://api.puppetlabs.com/razor/v1/collections/nodes","id":"http://localhost:8150/api/collections/nodes","params":{"start":{"type":"number"},"limit":{"type":"number"}}},{"name":"tasks","rel":"http://api.puppetlabs.com/razor/v1/collections/tasks","id":"http://localhost:8150/api/collections/tasks"},{"name":"commands","rel":"http://api.puppetlabs.com/razor/v1/collections/commands","id":"http://localhost:8150/api/collections/commands"},{"name":"events","rel":"http://api.puppetlabs.com/razor/v1/collections/events","id":"http://localhost:8150/api/collections/events","params":{"start":{"type":"number"},"limit":{"type":"number"}}},{"name":"hooks","rel":"http://api.puppetlabs.com/razor/v1/collections/hooks","id":"http://localhost:8150/api/collections/hooks"},{"name":"config","rel":"http://api.puppetlabs.com/razor/v1/collections/config","id":"http://localhost:8150/api/collections/config"}],"version":{"server":"v1.8.0-dirty"}}'
    http_version:
  recorded_at: Mon, 23 Apr 2018 19:48:15 GMT
- request:
    method: get
    uri: http://localhost:8150/api/commands/update-tag-rule
    body:
      encoding: US-ASCII
      string: ''
    headers:
      Accept:
      - application/json
      Accept-Encoding:
      - gzip, deflate
      User-Agent:
      - rest-client/2.0.2 (darwin x86_64) jruby/9.1.5.0 (2.3.1p0)
      Accept-Language:
      - en_US,en
      Host:
      - localhost:8150
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - Apache-Coyote/1.1
      Etag:
      - '"server-version-v1.8.0-dirty"'
      X-Content-Type-Options:
      - nosniff
      Content-Type:
      - application/json
      Content-Length:
      - '5021'
      Date:
      - Mon, 23 Apr 2018 19:48:15 GMT
    body:
      encoding: UTF-8
      string: '{"name":"update-tag-rule","help":{"summary":"Update the matching rule
        for an existing tag","description":"This will change the rule of the given
        tag to the new rule. The tag will be\nreevaluated against all nodes and each
        node''s tag attribute will be updated to\nreflect whether the tag now matches
        or not, i.e., the tag will be added\nto/removed from each node''s tag as appropriate.\n\nIf
        the tag is used by any policies, the update will only be performed if the\noptional
        parameter `force` is set to `true`. Otherwise, it will fail.","schema":"#
        Access Control\n\nThis command''s access control pattern: `commands:update-tag-rule:%{name}`\n\nWords
        surrounded by `%{...}` are substitutions from the input data: typically\nthe
        name of the object being modified, or some other critical detail, these\nallow
        roles to be granted partial access to modify the system.\n\nFor more detail
        on how the permission strings are structured and work, you can\nsee the [Shiro
        Permissions documentation][shiro].  That pattern is expanded\nand then a permission
        check applied to it, before the command is authorized.\n\nThese checks only
        apply if security is enabled in the Razor configuration\nfile; on this server
        security is currently disabled.\n\n[shiro]: http://shiro.apache.org/permissions.html\n\n#
        Attributes\n\n * name\n   - The tag for which to change the rule.\n   - This
        attribute is required.\n   - It must be of type string.\n   - It must match
        the name of an existing tag.\n   - Its argument position is 0.\n\n * rule\n   -
        The new rule to apply to the tag.\n   - This attribute is required.\n   -
        It must be of type array.\n   - Its argument position is 1.\n\n * force\n   -
        By default this command will fail if the tag is in use by an existing\n     policy.  This
        flag allows you to override that, and force the change to\n     apply despite
        the tag being in use.\n     \n     This will not change policy binding of
        nodes, which may lead to some\n     counter-intuitive results such as a node
        that does *not* match policy\n     tags being bound to the policy.\n   - It
        must be of type boolean.\n","examples":{"api":"An example of updating a tag
        rule, and forcing reevaluation:\n\n{\n  \"name\": \"small\",\n  \"rule\":
        [\"<=\", [\"fact\", \"processorcount\"], \"2\"],\n  \"force\": true\n}","cli":"An
        example of updating a tag rule, and forcing reevaluation:\n\n    razor update-tag-rule
        --name small --force \\\n        --rule ''[\"<=\", [\"fact\", \"processorcount\"],
        \"2\"]''\n\nWith positional arguments, this can be shortened:\n\n    razor
        update-tag-rule small ''[[\"<=\", [\"fact\", \"processorcount\"], \"2\"]]''
        \\\n        --force"},"full":"# SYNOPSIS\nUpdate the matching rule for an
        existing tag\n\n# DESCRIPTION\nThis will change the rule of the given tag
        to the new rule. The tag will be\nreevaluated against all nodes and each node''s
        tag attribute will be updated to\nreflect whether the tag now matches or not,
        i.e., the tag will be added\nto/removed from each node''s tag as appropriate.\n\nIf
        the tag is used by any policies, the update will only be performed if the\noptional
        parameter `force` is set to `true`. Otherwise, it will fail.\n# Access Control\n\nThis
        command''s access control pattern: `commands:update-tag-rule:%{name}`\n\nWords
        surrounded by `%{...}` are substitutions from the input data: typically\nthe
        name of the object being modified, or some other critical detail, these\nallow
        roles to be granted partial access to modify the system.\n\nFor more detail
        on how the permission strings are structured and work, you can\nsee the [Shiro
        Permissions documentation][shiro].  That pattern is expanded\nand then a permission
        check applied to it, before the command is authorized.\n\nThese checks only
        apply if security is enabled in the Razor configuration\nfile; on this server
        security is currently disabled.\n\n[shiro]: http://shiro.apache.org/permissions.html\n\n#
        Attributes\n\n * name\n   - The tag for which to change the rule.\n   - This
        attribute is required.\n   - It must be of type string.\n   - It must match
        the name of an existing tag.\n   - Its argument position is 0.\n\n * rule\n   -
        The new rule to apply to the tag.\n   - This attribute is required.\n   -
        It must be of type array.\n   - Its argument position is 1.\n\n * force\n   -
        By default this command will fail if the tag is in use by an existing\n     policy.  This
        flag allows you to override that, and force the change to\n     apply despite
        the tag being in use.\n     \n     This will not change policy binding of
        nodes, which may lead to some\n     counter-intuitive results such as a node
        that does *not* match policy\n     tags being bound to the policy.\n   - It
        must be of type boolean.\n\n# EXAMPLES\n\n  An example of updating a tag rule,
        and forcing reevaluation:\n  \n  {\n    \"name\": \"small\",\n    \"rule\":
        [\"<=\", [\"fact\", \"processorcount\"], \"2\"],\n    \"force\": true\n  }\n"},"schema":{"name":{"type":"string","position":0},"rule":{"type":"array","position":1},"force":{"type":"boolean"}}}'
    http_version:
  recorded_at: Mon, 23 Apr 2018 19:48:15 GMT
recorded_with: VCR 4.0.0
